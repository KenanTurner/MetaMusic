class musicManager{constructor(t,i={},e="html-player",s="sc-player",r="yt-player",a="https://w.soundcloud.com/player/api.js",l="https://www.youtube.com/iframe_api"){for(var n in this._myTimer,this.currentVol=1,this.currentlyPlaying={},this.currentDuration=0,this.currentTime=0,this._isPlaying=!1,this._isShuffling=!1,this._isLooping=!1,this._isPlayingLiked=!1,this._isShufflingAll=!1,this.data=t,this.trackType=i,this.shuffled={},this.data){let t={},i=JSON.parse(JSON.stringify(this.data[n])),e=Object.keys(i),s=Object.values(i);s=musicManager.shuffleArray(s);for(let r=0;r<e.length;r++)t[musicManager.getKeyByValue(i,s[r])]=s[r];this.shuffled[n]=t}this.subscribers={},this._htmlAudio=document.getElementById(e);var h=this;this._htmlAudio.addEventListener("ended",function(){h._isLooping?h._isPlaying?h.play():h.findNextTrack(0):h.findNextTrack(1)}),this._htmlAudio.addEventListener("timeupdate",function(){h._updateTime(h._htmlAudio.currentTime)}),this._SCAudio,this._YTAudio,this.currentlyPlaying.folder=Object.keys(this.data)[0],this.currentlyPlaying.track=Object.keys(this.data[this.currentlyPlaying.folder])[0];h=this;musicManager.loadScript(l,function(){console.log("Youtube Api has been loaded"),h._loadYT(h,r)}),musicManager.loadScript(a,function(){console.log("Soundcloud Api has been loaded"),h._loadSC(h,s)})}subscribe(t,i,...e){return this.subscribers[t]||(this.subscribers[t]=[]),this.subscribers[t].push([i,e]),this.subscribers}unsubscribe(t,i){return this.subscribers[t]&&this.subscribers[t].splice(this.subscribers[t].indexOf(i),1),this.subscribers[t]}_publish(t,i){if(this.subscribers[t])return this.subscribers[t].forEach(t=>t[0](i,...t[1])),i}_loadSC(t,i){t._SCAudio=SC.Widget(i),t._SCAudio.bind(SC.Widget.Events.FINISH,function(){t._isLooping?t._isPlaying?t.play():t.findNextTrack(0):t.findNextTrack()}),t._SCAudio.bind(SC.Widget.Events.PLAY_PROGRESS,function(i){t._updateTime(i.currentPosition/1e3)}),console.log("Soundcloud is ready")}_loadYT(t,i){window.YT.ready(function(){t._YTAudio=new window.YT.Player(i,{height:"144",width:"100%",playerVars:{controls:0,disablekb:1,fs:0,modestbranding:1,playsinline:1},videoId:""}),t._YTAudio.addEventListener("onStateChange","_globalYTEvent"),t._YTAudio.addEventListener("onReady","_globalYTReady")})}_YTEvent(t){if(0==t.data&&(this._isLooping?this.isPlaying?this.play():this.findNextTrack(0):this.findNextTrack()),1==t.data){this._setDuration(this._YTAudio.getDuration());var i=this;this._myTimer=setInterval(function(){i._updateTime(i._YTAudio.getCurrentTime())},100)}1!=t.data&&clearInterval(this._myTimer)}play(){let t=this;switch(this.currentlyPlaying.filetype){case"HTML":this._htmlAudio.play(),this._getHTMLAudioDuration(this.currentlyPlaying.src,function(i){t._setDuration(i)});break;case"SC":this._SCAudio.bind(SC.Widget.Events.READY,function(){t._SCAudio.getDuration(function(i){t._setDuration(i/1e3)}),"SC"==t.currentlyPlaying.filetype&&t._SCAudio.play(),t._SCAudio.setVolume(100*t.currentVol)});break;case"YT":this._YTAudio.playVideo()}return this._isPlaying=!0,this._publish(this.play,this._isPlaying)}pause(){return this._htmlAudio.pause(),this._YTAudio.pauseVideo(),this._SCAudio.pause(),this._isPlaying=!1,this._publish(this.pause,this._isPlaying)}togglePlay(){return this._isPlaying?this.pause():this.play(),this._publish(this.togglePlay,this._isPlaying)}_setTrack(t=this.currentlyPlaying.folder,i=this.currentlyPlaying.track){this.currentlyPlaying.folder=t,this.currentlyPlaying.track=i;let e=this.data[t][i],s=musicManager.getFiletype(e);switch(this.currentlyPlaying.src=e,this.currentlyPlaying.filetype=s,this._stopPlaying(),this.currentlyPlaying.filetype){case"HTML":this._htmlAudio.src=e;break;case"SC":this._SCAudio.load(e+"&auto_play=false&buying=false&liking=false&download=false&sharing=false&show_artwork=false&show_comments=false&show_playcount=false&show_user=false&hide_related=false&visual=false&start_track=0&callback=true");break;case"YT":this._YTAudio.cueVideoById(musicManager.getYoutubeId(e),0)}return this._isPlaying&&this.play(),this._publish(this._setTrack,this.currentlyPlaying)}findNextTrack(t=1,i=!1){if(this._isShufflingAll){var e=this._getRandomTrack();this.currentlyPlaying.folder=e.folder,this.currentlyPlaying.track=e.track}if(this._isPlayingLiked){let i=Object.keys(this._likedTracks).indexOf(this.currentlyPlaying.src);return(i+=t)>=Object.keys(this._likedTracks).length&&(i=0,this.pause()),i<0&&(i=Object.keys(this._likedTracks).length-1),this.currentlyPlaying.folder=Object.values(this._likedTracks)[i].folder,this.currentlyPlaying.track=Object.values(this._likedTracks)[i].track,this._setTrack()}if(i||this._isShufflingAll){let e=Object.keys(this.data[this.currentlyPlaying.folder]),s=e.indexOf(this.currentlyPlaying.track);this._isShuffling&&(s=(e=Object.keys(this.shuffled[this.currentlyPlaying.folder])).indexOf(this.currentlyPlaying.track)),s+=t,0==t&&(t=1),s>=e.length&&(s=0,this._isShufflingAll||this.pause()),s<0&&(s=e.length-1);let r=this.data[this.currentlyPlaying.folder][e[s]];return this._isShuffling&&(r=this.shuffled[this.currentlyPlaying.folder][e[s]]),this.currentlyPlaying.track=e[s],"skipped"==this.trackType[r]?this.findNextTrack(t,i=!0):this._setTrack()}return this._checkFolder(this.currentlyPlaying.folder)?this.findNextFolder(1):this.findNextTrack(t,i=!0)}findNextFolder(t=1,i=!1){let e=Object.keys(this.data),s=e.indexOf(this.currentlyPlaying.folder);if((s+=t)>=e.length&&(s=0),s<0&&(s=e.length-1),!this._checkFolder(e[s]))return this.currentlyPlaying.folder=e[s],this.currentlyPlaying.track=Object.keys(this.data[e[s]])[0],this.findNextTrack(0,!0);if(!i){if(this._checkAllFolders())return this.currentlyPlaying.folder=Object.keys(this.data)[0],this.currentlyPlaying.track=Object.keys(this.data[this.currentlyPlaying.folder])[0],this._setTrack();i=!0}this.currentlyPlaying.folder=e[s],this.findNextFolder(t)}findTrack(t,i){return this.currentlyPlaying.folder=t,this.currentlyPlaying.track=i,this.findNextTrack(0)}fastForward(t){let i=this;switch(this.currentlyPlaying.filetype){case"HTML":return this._htmlAudio.currentTime+=t,this._updateTime(this._htmlAudio.currentTime);case"SC":this._SCAudio.getPosition(function(e){return e+=1e3*t,i._SCAudio.seekTo(e),i._updateTime(e/1e3)});break;case"YT":if(0!=this.currentDuration){let i=this._YTAudio.getCurrentTime();return i+=t,this._YTAudio.seekTo(i,!0),this._updateTime(i)}}}changeVolume(t,i=!1){return this.currentVol+=t,i&&(this.currentVol=t),this.currentVol>1&&(this.currentVol=1),this.currentVol<0&&(this.currentVol=0),this._htmlAudio.volume=this.currentVol,this._YTAudio.setVolume(100*this.currentVol),this._SCAudio.setVolume(100*this.currentVol),this._publish(this.changeVolume,this.currentVol)}_stopPlaying(){this._htmlAudio.pause(),this._YTAudio.pauseVideo(),this._SCAudio.pause(),this._setDuration(0),this._updateTime(0)}toggleLoop(){return this._isLooping?this._isLooping=!1:this._isLooping=!0,this._publish(this.toggleLoop,this._isLooping)}toggleShuffle(){return this._isShuffling?(this._isShuffling=!1,this.currentlyPlaying.track=Object.keys(this.data[this.currentlyPlaying.folder])[0],this.findNextTrack(0)):(this._isShuffling=!0,this._isShufflingAll&&this.toggleShuffleAll(),this._isPlayingLiked&&this.toggleLikedTracks(),this.currentlyPlaying.track=Object.keys(this.shuffled[this.currentlyPlaying.folder])[0],this.findNextTrack(0)),this._publish(this.toggleShuffle,this._isShuffling)}toggleShuffleAll(){return this._isShufflingAll?this._isShufflingAll=!1:(this._isShufflingAll=!0,this._isShuffling&&this.toggleShuffle(),this._isPlayingLiked&&this._toggleLikedTracks(),this.findNextTrack(0)),this._publish(this.toggleShuffleAll,this._isShufflingAll)}toggleLikedTracks(){if(this._isPlayingLiked)this._isPlayingLiked=!1,this.currentlyPlaying.track=Object.keys(this.data[this.currentlyPlaying.folder])[0],this.findNextTrack(0);else{this._isShufflingAll&&this.toggleShuffleAll(),this._isShuffling&&this.toggleShuffle();var t=!0;this._likedTracks={};for(var i in this.trackType)if("liked"==this.trackType[i])for(var e in t=!1,this.data){var s=musicManager.getKeyByValue(this.data[e],i);s&&(this._likedTracks[i]={folder:e,track:s})}t?alert("Zero tracks have been liked. Like a track to get started!"):(this._isPlayingLiked=!0,this._likedTracks=musicManager.shuffleDict(this._likedTracks),this.currentlyPlaying.src=Object.keys(this._likedTracks)[0],this.findNextTrack(0,!0))}return this._publish(this.toggleLikedTracks,this._isPlayingLiked)}setTrackType(t,i=!1,e=this.currentlyPlaying.src){return this.trackType[e]!=t||i?(this.trackType[e]=t,e==this.currentlyPlaying.src&&"skipped"==t&&this.findNextTrack(1)):delete this.trackType[e],this._publish(this.setTrackType,this.trackType)}resetTracksByType(t){if(t)for(var i in this.trackType)this.trackType[i]==t&&delete this.trackType[i];else this.trackType={};return this._publish(this.resetTracksByType,this.trackType)}_getHTMLAudioDuration(t,i){var e=new Audio(t);e.addEventListener("durationchange",function(t){if(this.duration!=1/0){var s=this.duration;e.remove(),i(s)}},!1),e.load(),e.currentTime=86400,e.volume=0,e.play()}_setDuration(t){return this.currentDuration=t,this._publish(this._setDuration,this.currentDuration)}_updateTime(t){return this.currentTime=t,this._publish(this._updateTime,this.currentTime)}_checkFolder(t){var i=!0,e=this;return Object.keys(this.data[t]).forEach(function(s){if("skipped"!=e.trackType[e.data[t][s]])return i=!1}),i}_checkAllFolders(){var t=!0,i=this;return Object.keys(this.data).forEach(function(e){if(!i._checkFolder(e))return t=!1}),t}_getRandomTrack(){var t=Math.floor(Math.random()*Object.keys(this.data).length),i=Math.floor(Math.random()*Object.keys(this.data[Object.keys(this.data)[t]]).length);return{folder:Object.keys(this.data)[t],track:Object.keys(this.data[Object.keys(this.data)[t]])[i]}}static getFiletype(t){return t.search("soundcloud")>-1?"SC":""!=musicManager.getYoutubeId(t)?"YT":"HTML"}static getKeyByValue(t,i){return Object.keys(t).find(e=>t[e]===i)}static shuffleArray(t,i=1,e=1){for(var s=0;s<t.length;s++){const i=Math.floor(Math.random()*s),e=t[s];t[s]=t[i],t[i]=e}return e<i?musicManager.shuffleArray(t,i,e+=1):t}static shuffle2dArray(t){for(var i=0;i<t.length;i++)t[i]=musicManager.shuffleArray(t[i]);return t}static shuffleDict(t){let i={},e=Object.keys(t),s=Object.values(t);s=musicManager.shuffleArray(s);for(let r=0;r<e.length;r++)i[musicManager.getKeyByValue(t,s[r])]=s[r];return i}static loadScript(t,i){var e=document.head,s=document.createElement("script");s.type="text/javascript",s.src=t,s.onreadystatechange=i,s.onload=i,e.appendChild(s)}static mobileAndTabletCheck(){let t=!1;var i;return i=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4)))&&(t=!0),t}static getYoutubeId(t){if(11==t.length&&-1==t.indexOf("."))return t;let i=new URL(t);if("www.youtube.com"==i.hostname||"youtu.be"==i.hostname){if("/watch"==i.pathname){let t=i.search.indexOf("?v=");return i.search.substr(t+3,11)}return i.pathname.substr(1,11)}return""}}function _globalYTEvent(t){for(var i in window)window[i]instanceof musicManager&&window[i]._YTEvent(t)}function _globalYTReady(t){for(var i in console.log("Youtube is ready"),window)window[i]instanceof musicManager&&window[i].findNextTrack(0)}
