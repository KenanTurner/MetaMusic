import HTML from '../html.min.js';
export default class BC extends HTML{constructor(r="../../dist/plugins/bc.min.php"){super(),this._bc_php=r}load(r){if(!this.constructor._validTrack(r))throw new Error("Invalid Filetype");return r.bc_url==r.src?fetch(this._bc_php,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({href:r.bc_url})}).then(function(r){return r.json()}).then(function(t){return 0==Object.values(t).length?Promise.reject("Invalid Url"):(r.src=Object.values(t)[0],this.load(r))}.bind(this)).catch(function(r){return Promise.reject(this._publish("error"))}.bind(this)):super.load(r)}}BC.Track=class extends HTML.Track{constructor(r){super(r),this.filetype="BC",this.bc_url=this.src}toJSON(){let r=super.toJSON();return r.src=this.bc_url,r}},BC.Track.fromJSON=function(r){return new BC.Track(JSON.parse(r))},BC._validURL=function(r){try{let t=new URL(r).hostname.split(".");return t.shift(),"bandcamp.com"==(t=t.join("."))}catch(r){return!1}};
