import {Player} from '../../core.min.js';
export default class HTML extends Player{static Track=class extends Player.Track{constructor(t){super(t),this.filetype="HTML"}static fromJSON(t){return new HTML.Track(JSON.parse(t))}};constructor(){super(!0),this._player=new Audio;let t=function(t){return function(){this.publish(new this.constructor.Event(t))}.bind(this)}.bind(this);this._player.addEventListener("play",t("play")),this._player.addEventListener("pause",t("pause")),this._player.addEventListener("ended",t("ended")),this._player.addEventListener("error",t("error")),this._player.addEventListener("timeupdate",t("timeupdate")),this._player.addEventListener("volumechange",t("volumechange"))}async destroy(){return this._player.src="",this._player.load(),super.destroy()}async load(t){if(!this.constructor.isValidTrack(t))throw new Error("Invalid Filetype");let e=function(){this.publish(new this.constructor.Event("loaded"))}.bind(this);return this._player.addEventListener("canplay",e,{once:!0}),this._player.src=t.src,this.waitForEvent("loaded")}async play(){if(!(await this.getStatus()).paused)return this.publish(new this.constructor.Event("play"));let t=this.waitForEvent("play");return this._player.play(),t}async pause(){if((await this.getStatus()).paused)return this.publish(new this.constructor.Event("pause"));let t=this.waitForEvent("pause");return this._player.pause(),t}async seek(t){return this._player.currentTime=t,this.waitForEvent("timeupdate")}async fastForward(t){let e=await this.getStatus();return this.seek(e.time+t)}async setVolume(t){return(await this.getStatus()).volume==t?this.publish(new this.constructor.Event("volumechange")):(this._player.volume=t,this.waitForEvent("volumechange"))}async setMuted(t){let e=await this.getStatus(),s=this.waitForEvent("volumechange");return this._player.muted=t,e.muted==t?this.publish(new this.constructor.Event("volumechange")):s}async stop(){return await this.pause(),await this.seek(0),this.publish(new this.constructor.Event("stop"))}async getStatus(){let t={};return t.src=this._player.currentSrc,t.time=this._player.currentTime,t.duration=this._player.duration,t.volume=this._player.volume,t.paused=this._player.paused,t.muted=this._player.muted,t}}
