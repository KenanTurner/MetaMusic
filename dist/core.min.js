class Track{constructor(t){if(!t.src||!t.title)throw new Error("Invalid Constructor");this.filetype="DEFAULT",this.src=t.src,this.title=t.title}toJSON(){let t={};return t.filetype=this.filetype,t.src=this.src,t.title=this.title,t}clone(){return this.constructor.fromJSON(JSON.stringify(this))}equals(t){return JSON.stringify(this)===JSON.stringify(t)}compare(t,r="title"){return this[r]<t[r]?-1:this[r]>t[r]?1:this[r]===t[r]?0:void 0===this[r]?-1:void 0===t[r]?1:0}toString(){return JSON.stringify(this)}valueOf(){return JSON.stringify({src:this.src,title:this.title})}}Track.fromJSON=function(t){return new Track(JSON.parse(t))};
class EventTarget{constructor(r=!0){this._subscribers={all:[]},this._ready=r}subscribe(r,s,t){if("function"!=typeof s)throw new Error("Callback must be a function");let e={callback:s};t&&(e.once=t.once),t&&(e.error=t.error),this._subscribers[r]||(this._subscribers[r]=[]),this._subscribers[r].push(e),"ready"==r&&this._ready&&this._publish("ready")}unsubscribe(r,s,t){if("function"!=typeof s)throw new Error("Callback must be a function");let e={callback:s};if(t&&(e.once=t.once),t&&(e.error=t.error),this._subscribers[r]){var i=this._subscribers[r].filter(function(r){return r===e});this._subscribers[r]=i}}_publish(r){if(!this._ready)return;let s=new this.constructor.Event(r,this.getStatus(),this);if("error"===r)for(let r in this._subscribers){let t=this._subscribers[r].filter(function(r){return r.error&&r.error(s),!r.error||!r.once});this._subscribers[r]=t}let t=function(r){return r.callback(s),!r.once};return"all"!==r&&(this._subscribers.all=this._subscribers.all.filter(t)),this._subscribers[r]?(this._subscribers[r]=this._subscribers[r].filter(t),s):void 0}getStatus(){}waitForEvent(r){return new Promise(function(s,t){this.subscribe(r,s,{once:!0,error:t})}.bind(this))}chain(r,...s){return function(t){return this[r](...s)}.bind(this)}}EventTarget.Event=class{constructor(r,s,t){this.type=r,this.data=s,this.target=t}};
var ModuleManager={relative_path:"../",importModule:function(...e){if(0==e.length)return Promise.reject({});let t=e.shift();return import(ModuleManager.relative_path+t).then(function(e){let t={};for(let r in e)t[r]=e[r];return Promise.resolve(t)}).catch(function(r){return console.log("Error loading "+t,r),ModuleManager.importModule(...e)})},importModules:function(e){for(let t in e)e[t]=ModuleManager.importModule(...e[t]).then(function(r){e[t]=r},function(e){console.log(t+" failed to load any files!")});return Promise.allSettled(Object.values(e)).then(function(){return Promise.resolve(e)})},importScript:function(...e){if(0==e.length)return Promise.reject({});let t=e.shift(),r=document.head,o=document.createElement("script");return o.type="text/javascript",o.src=t,new Promise(function(e,t){o.onreadystatechange=e,o.onload=e,o.onerror=t,r.appendChild(o)}).catch(function(r){return console.log("Error loading "+t,r),ModuleManager.importScript(...e)})},importScripts:function(e){for(let t in e)e[t]=ModuleManager.importScript(...e[t]).catch(function(e){console.log(t+" failed to load any files!")});return Promise.allSettled(Object.values(e)).then(function(){return Promise.resolve(e)})}};
class Album extends EventTarget{constructor(t){if(super(),!t.title)throw new Error("Invalid Constructor");this.title=t.title,this.tracks=[],t.tracks&&this.add(...t.tracks),this.sort("track_num",!1,!1)}add(...t){t.forEach(function(t){try{t.toJSON&&(t={track_num:t.track_num,...t.toJSON()});let r=new this.constructor.players[t.filetype].Track(t);if(!this.constructor._validTrack(r))throw new Error("Unsupported Track Type");r.track_num=t.track_num,this.tracks.push(r)}catch(t){console.log(t)}}.bind(this)),this.sort(this.sort_key,this.sort_reversed,!1),this._publish("add")}has(t){return this.tracks.some(function(r){if(r.equals(t))return!0})}sort(t="track_num",r=!1,s=!0){this.tracks.sort(function(r,s){let e=r.compare(s,t);return 0===e&&(e=r.compare(s,"title")),e}),r&&this.tracks.reverse(),this.sort_key=t,this.sort_reversed=r,s&&this._publish("sort")}clear(){this.tracks.length=0,this._publish("clear")}remove(t){this.tracks=this.tracks.filter(function(r){if(!r.equals(t))return!0}),this._publish("remove")}get length(){return this.tracks.length}toJSON(){let t={};t.title=this.title,t.tracks=[];let r=this.sort_key;return this.sort("track_num",!1,!1),this.tracks.forEach(function(r,s){let e=r.toJSON();e.track_num=r.track_num,t.tracks.push(e)}.bind(this)),this.sort(r,!1,!1),t}clone(){return this.constructor.fromJSON(JSON.stringify(this))}equals(t){return JSON.stringify(this)===JSON.stringify(t)}toString(){return JSON.stringify(this)}getInfo(t){let r=[];return this.tracks.forEach(function(s){s[t]&&r.push(s[t])}.bind(this)),r}getStatus(){return"Overridden in album.js"}}Album.players={},Album._validTrack=function(t){return Object.values(Album.players).some(function(r){return r._validTrack(t)})},Album.fromJSON=function(t){let r=JSON.parse(t);return r.tracks.forEach(function(t,r,s){s[r].track_num=t.track_num}.bind(this)),new Album(r)};
export {Track, EventTarget, ModuleManager, Album};
